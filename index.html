<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreetCover - 3D Interactive</title>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- Three.js Import Map -->
    <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.158.0/examples/jsm/"
        }
      }
    </script>

    <style>
        /* --- RESET E STILI GLOBALI --- */
        :root {
            --background-color: #000000; /* Sfondo nero */
            --text-color: #FFFFFF; /* Testo bianco */
            --primary-red: #E50914;
            /* Colori SOLO per il testo liquido */
            --soft-blue: #64C2F8;
            --soft-pink: #FF66A3;
            --soft-green: #72F8B6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- SFONDO "LIQUID GLASS" SCURO --- */
        .liquid-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            filter: blur(120px);
        }

        .liquid-shape {
            position: absolute;
            border-radius: 50%;
            opacity: 0.6;
        }

        .bg-shape-1 {
            width: 450px; height: 450px; background-color: var(--primary-red);
            top: 5vh; left: 10vw; animation: move-liquid 62s infinite alternate; /* Rallentato */
        }
        .bg-shape-2 {
            width: 550px; height: 550px; background-color: #222;
            bottom: 10vh; right: 5vw; animation: move-liquid-2 78s infinite alternate-reverse; /* Rallentato */
        }
        .bg-shape-3 {
            width: 350px; height: 350px; background-color: var(--text-color); opacity: 0.1;
            top: 40vh; right: 35vw; animation: move-liquid 55s infinite alternate; /* Rallentato e corretto per usare la stessa animazione */
        }

        @keyframes move-liquid {
            from { transform: translate(0, 0) rotate(0deg) scale(1); }
            to { transform: translate(150px, 200px) rotate(180deg) scale(1.2); }
        }
        @keyframes move-liquid-2 {
            from { transform: translate(0, 0) rotate(0deg) scale(1.2); }
            to { transform: translate(-50px, -100px) rotate(-180deg) scale(1); }
        }

        /* --- ANIMAZIONE DI TRANSIZIONE --- */
        .transition-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999; background-color: var(--background-color);
            opacity: 1; visibility: visible; transition: opacity 0.8s ease-in-out, visibility 0.8s;
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        .transition-overlay .liquid-background { filter: blur(80px); }
        .transition-overlay.hidden { opacity: 0; visibility: hidden; }
        main, header { opacity: 0; transition: opacity 0.6s ease-in-out 0.3s; }
        body.loaded main, body.loaded header { opacity: 1; }

        /* --- HEADER --- */
        header {
            position: absolute; width: 100%; padding: 25px 5%; display: flex;
            justify-content: space-between; align-items: center; z-index: 100;
        }
        .logo {
            font-size: 1.8em; font-weight: 900; text-decoration: none; cursor: pointer;
            color: var(--text-color);
        }
        
        /* --- MENU HAMBURGER "GLASS" --- */
        .hamburger-container {
            width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
            cursor: pointer; z-index: 101; background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        .hamburger-container:hover { background: rgba(255, 255, 255, 0.2); }
        .hamburger-icon { width: 24px; height: 18px; display: flex; flex-direction: column; justify-content: space-between; }
        .hamburger-icon span { width: 100%; height: 3px; background-color: var(--text-color); border-radius: 3px; transition: all 0.3s ease; }
        .hamburger-container.active .hamburger-icon span:nth-child(1) { transform: translateY(7.5px) rotate(45deg); }
        .hamburger-container.active .hamburger-icon span:nth-child(2) { opacity: 0; }
        .hamburger-container.active .hamburger-icon span:nth-child(3) { transform: translateY(-7.5px) rotate(-45deg); }

        /* --- MENU A TENDINA (OVERLAY) --- */
        .nav-menu {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.7); backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%); z-index: 99;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .nav-menu.active { opacity: 1; visibility: visible; }
        .nav-menu a {
            color: var(--text-color); font-size: 2.5rem; font-weight: 700;
            margin: 20px 0; text-decoration: none; transition: color 0.3s;
        }
        .nav-menu a:hover { color: var(--primary-red); }
        
        /* --- SEZIONI PRINCIPALI --- */
        main section { width: 100%; min-height: 100vh; padding: 50px 5%; }
        .home-section { 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding-top: 100px;
        }
        .hidden { display: none !important; }

        /* --- TESTO "LIQUID GLASS" CON GRADIENTE ANIMATO --- */
        @keyframes animated-gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .liquid-glass-text {
            background: linear-gradient( 45deg, var(--soft-blue), var(--soft-pink), var(--soft-green), var(--soft-blue) );
            background-size: 400% 400%;
            animation: animated-gradient 10s ease infinite;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            -webkit-text-stroke: 0.5px rgba(255,255,255,0.1);
        }

        /* --- HOMEPAGE LAYOUT --- */
        .hero-layout {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
        }
        .hero-text {
            text-align: center;
            z-index: 10;
            flex-basis: 100%;
        }
        .hero-text h1 { font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
        .hero-text p { font-size: 1.2rem; max-width: 600px; margin: 20px auto 0 auto; line-height: 1.6; font-weight: 400; }
        
        .glass-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin-top: 40px; padding: 15px 40px; border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px; background: rgba(20, 20, 20, 0.3); backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%); color: var(--text-color); font-size: 1.1em;
            font-weight: 700; text-decoration: none; transition: all 0.2s ease; cursor: pointer;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .glass-button:hover {
            background: rgba(229, 9, 20, 0.8); border-color: rgba(229, 9, 20, 0); transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(229, 9, 20, 0.6);
        }
        
        /* --- CONTENITORE MODELLO 3D --- */
        #model-container {
            width: 120%;
            height: 700px; 
            z-index: 5;
            cursor: grab;
            margin-top: -10px; /* Riposizionato pi√π in alto */
            position: relative;
        }
        #model-container:active { cursor: grabbing; }

        /* --- PAGINA PRODOTTI --- */
        .products-section h2 { text-align: center; font-size: clamp(2.5rem, 6vw, 3.5rem); font-weight: 900; text-transform: uppercase; margin-bottom: 50px; margin-top: 50px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 40px; max-width: 1200px; margin: 0 auto; }
        .product-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            backdrop-filter: blur(30px) saturate(180%); -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18); border-radius: 30px; overflow: hidden;
            text-align: center; transition: transform 0.4s ease, box-shadow 0.4s ease, border-color 0.4s ease;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            will-change: transform; 
        }
        .product-card:hover { transform: translateY(-15px) scale(1.03); box-shadow: 0 0 40px rgba(229, 9, 20, 0.5); border-color: rgba(255, 255, 255, 0.4); }
        .product-image {
            position: relative;
            width: 100%;
            padding-top: 150%; 
            overflow: hidden;
            cursor: pointer;
        }
        .product-image img, .product-image video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border: none;
        }
        .product-card h3 { font-size: 1.5em; margin-top: 20px; }
        .product-card .price { font-size: 1.2em; font-weight: 700; margin: 10px 0; opacity: 0.9; }
        .buy-button {
            padding: 12px 30px; margin: 15px 0 25px 0; border: none; border-radius: 50px;
            background-color: var(--primary-red); color: #fff; font-weight: 700; cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: inline-block; text-decoration: none;
        }
        .buy-button:hover { background-color: #c40812; transform: scale(1.05); }
        
        /* --- PAGINA CONTATTI --- */
        .contacts-section {
            display: flex; 
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        .contacts-section h2 {
            text-align: center;
            font-size: clamp(2.5rem, 6vw, 3.5rem);
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 60px;
        }

        /* --- OTTIMIZZAZIONE MOBILE --- */
        @media (max-width: 768px) {
            .nav-menu a {
                font-size: 2rem; 
            }
            .hero-text h1 {
                font-size: clamp(2.2rem, 10vw, 3rem); 
            }
            .hero-text p {
                font-size: 1rem;
            }
            #model-container {
                height: 500px; 
                margin-top: 10px; 
            }
        }

    </style>
</head>
<body>

    <!-- Overlay di transizione -->
    <div class="transition-overlay" id="transition-overlay">
        <div class="liquid-background">
            <div class="liquid-shape bg-shape-1"></div>
            <div class="liquid-shape bg-shape-2"></div>
            <div class="liquid-shape bg-shape-3"></div>
        </div>
    </div>

    <!-- Sfondo animato -->
    <div class="liquid-background">
        <div class="liquid-shape bg-shape-1"></div>
        <div class="liquid-shape bg-shape-2"></div>
        <div class="liquid-shape bg-shape-3"></div>
    </div>

    <header>
        <a class="logo">StreetCover</a>
        <div class="hamburger-container" id="hamburger-container">
            <div class="hamburger-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <nav class="nav-menu" id="nav-menu">
        <a href="#home">Home</a>
        <a href="#prodotti">Prodotti</a>
        <a href="#contatti">Contatti</a>
    </nav>

    <main>
        <!-- SEZIONE 1: HOMEPAGE -->
        <section class="home-section" id="home">
            <div class="hero-layout">
                
                <div class="hero-text">
                    <h1 class="liquid-glass-text">IL TUO STILE, LA TUA STRADA</h1>
                    <p class="liquid-glass-text">Cover uniche per persone uniche. Esplora un design che rompe gli schemi e protegge ci√≤ che conta.</p>
                    <a href="#" class="glass-button" data-target="prodotti">SCOPRI ORA</a>
                </div>
                
                <div id="model-container"></div>

            </div>
        </section>

        <!-- SEZIONE 2: PRODOTTI (nascosta di default) -->
        <section class="products-section hidden" id="prodotti">
            <h2 class="liquid-glass-text">Le Nostre Cover</h2>
            <div class="products-grid">
                <!-- Prodotto 1: Rossa -->
                <div class="product-card">
                    <div class="product-image">
                        <video src="https://github.com/antoney2002/streetcover/raw/refs/heads/main/video%20rossa0001-0250.webm" muted playsinline></video>
                    </div>
                    <h3>Rosso Fuoco</h3>
                    <p class="price">14,99 ‚Ç¨</p>
                    <a href="https://buy.stripe.com/7sY28rg3u7IO2Nn9nu0Ny09" target="_blank" class="buy-button">Acquista Ora</a>
                </div>

                <!-- Prodotto 2: Nera -->
                <div class="product-card">
                    <div class="product-image">
                        <video src="https://github.com/antoney2002/streetcover/raw/refs/heads/main/video%20nera0001-0250.webm" muted playsinline></video>
                    </div>
                    <h3>Nero Assoluto</h3>
                    <p class="price">14,99 ‚Ç¨</p>
                    <a href="https://buy.stripe.com/aFa5kDdVm1kqbjTary0Ny08" target="_blank" class="buy-button">Acquista Ora</a>
                </div>

                <!-- Prodotto 3: Trasparente -->
                <div class="product-card">
                    <div class="product-image">
                        <video src="https://github.com/antoney2002/streetcover/raw/refs/heads/main/video%20trasparente0001-0250.webm" muted playsinline></video>
                    </div>
                    <h3>Cristallo Puro</h3>
                    <p class="price">14,99 ‚Ç¨</p>
                    <a href="https://buy.stripe.com/00w8wP18A9QW0Ff2Z60Ny0a" target="_blank" class="buy-button">Acquista Ora</a>
                </div>

                <!-- Prodotto 4: Bianca -->
                <div class="product-card">
                    <div class="product-image">
                        <video src="https://github.com/antoney2002/streetcover/raw/refs/heads/main/video%20bianca0001-0250.webm" muted playsinline></video>
                    </div>
                    <h3>Bianco Ghiaccio</h3>
                    <p class="price">14,99 ‚Ç¨</p>
                    <a href="https://buy.stripe.com/8wMbIQajbdd30ZW004" target="_blank" class="buy-button">Acquista Ora</a>
                </div>
            </div>
        </section>

        <!-- SEZIONE 3: CONTATTI (nascosta di default) -->
        <section class="contacts-section hidden" id="contatti">
            <h2 class="liquid-glass-text">Seguici sui Social</h2>
            <a href="https://www.instagram.com/streetcoverofficial/" target="_blank" class="glass-button">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                <span>Vai a Instagram</span>
            </a>
        </section>
    </main>

    <script>
        // Script per la navigazione e le transizioni
        document.addEventListener('DOMContentLoaded', () => {
            const hamburgerContainer = document.getElementById('hamburger-container');
            const navMenu = document.getElementById('nav-menu');
            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('.nav-menu a');
            const scopriOraBtn = document.querySelector('.glass-button');
            const logo = document.querySelector('.logo');
            const transitionOverlay = document.getElementById('transition-overlay');
            const modelContainer = document.getElementById('model-container');

            function runTransition(callback) {
                transitionOverlay.classList.remove('hidden');
                setTimeout(() => {
                    callback();
                    setTimeout(() => {
                        transitionOverlay.classList.add('hidden');
                    }, 200);
                }, 800);
            }
            
            window.addEventListener('load', () => {
                setTimeout(() => {
                    transitionOverlay.classList.add('hidden');
                    document.body.classList.add('loaded');
                }, 500);
            });

            function showPage(pageId) {
                sections.forEach(section => {
                    section.id === pageId ? section.classList.remove('hidden') : section.classList.add('hidden');
                });
                window.scrollTo(0, 0);
            }

            hamburgerContainer.addEventListener('click', () => {
                hamburgerContainer.classList.toggle('active');
                navMenu.classList.toggle('active');
            });

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = e.currentTarget.getAttribute('href').substring(1);
                    runTransition(() => {
                        showPage(targetId);
                        hamburgerContainer.classList.remove('active');
                        navMenu.classList.remove('active');
                    });
                });
            });

            scopriOraBtn.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = scopriOraBtn.getAttribute('data-target');
                runTransition(() => showPage(targetId));
            });
            
            logo.addEventListener('click', () => {
                runTransition(() => showPage('home'));
            });

            if(modelContainer) {
                modelContainer.addEventListener('navigateToProducts', () => {
                    runTransition(() => showPage('prodotti'));
                });
            }
            
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                const video = card.querySelector('video');
                if (!video) return;

                const resetVideo = () => {
                    video.pause();
                    video.currentTime = video.duration / 2 || 0;
                };

                video.addEventListener('loadedmetadata', resetVideo);
                
                const playVideo = () => {
                    if (video.paused) {
                        video.currentTime = 0;
                        video.play();
                    }
                };
                
                // Su Desktop, usa hover
                if (window.matchMedia("(hover: hover)").matches) {
                    card.addEventListener('mouseenter', playVideo);
                    card.addEventListener('mouseleave', resetVideo);
                }

                // Su Mobile (e anche Desktop), usa click/tap
                card.addEventListener('click', () => {
                     if (video.paused) {
                        // Metti in pausa tutti gli altri video prima di far partire questo
                        productCards.forEach(otherCard => {
                            const otherVideo = otherCard.querySelector('video');
                            if (otherVideo && otherVideo !== video) {
                                otherVideo.pause();
                                otherVideo.currentTime = otherVideo.duration / 2 || 0;
                            }
                        });
                        playVideo();
                    } else {
                        resetVideo();
                    }
                });

                 video.addEventListener('ended', resetVideo);
            });


            showPage('home');
        });
    </script>
    
    <!-- Script per il modello 3D con Three.js -->
     <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

        const container = document.getElementById('model-container');
        if (container) {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 30); // Allontanata per evitare ritagli

            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            const loader = new GLTFLoader();
            const pivot = new THREE.Group();
            scene.add(pivot);

            const models = [];
            let activeModelIndex = 0;
            let lastAngle = 0;
            const modelUrls = [
                'https://cdn.jsdelivr.net/gh/antoney2002/streetcover/covwe.glb',
                'https://cdn.jsdelivr.net/gh/antoney2002/streetcover/cov3we.glb',
                'https://cdn.jsdelivr.net/gh/antoney2002/streetcover/covne.glb',
            ];

            function prepareModel(obj) {
                obj.traverse((child) => {
                    if (child.isMesh && child.material) {
                        const apply = (mat) => {
                            mat.transparent = true;
                            mat.needsUpdate = true;
                        };
                        if (Array.isArray(child.material)) {
                            child.material.forEach(apply);
                        } else {
                            apply(child.material);
                        }
                    }
                });
            }

            function setOpacity(obj, opacity) {
                if (!obj) return;
                obj.traverse((child) => {
                    if (child.isMesh && child.material) {
                        const apply = (mat) => mat.opacity = opacity;
                        if (Array.isArray(child.material)) {
                            child.material.forEach(apply);
                        } else {
                            apply(child.material);
                        }
                    }
                });
            }
            
            modelUrls.forEach((url, index) => {
                loader.load(url, (gltf) => {
                    const model = gltf.scene;
                    model.scale.set(1.7, 1.7, 1.7);
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.sub(center);
                    prepareModel(model);
                    setOpacity(model, index === 0 ? 1 : 0); // Visibile solo il primo
                    pivot.add(model);
                    models[index] = model;
                });
            });


            let isDragging = false;
            const previousMousePosition = { x: 0, y: 0 };
            const startMousePosition = { x: 0, y: 0 };
            const clickThreshold = 5;

            function onMouseDown(event) {
                isDragging = true;
                previousMousePosition.x = event.clientX;
                startMousePosition.x = event.clientX;
                startMousePosition.y = event.clientY;
            }

            function onMouseMove(event) {
                if (isDragging) {
                    const deltaMove = { x: event.clientX - previousMousePosition.x };
                    pivot.rotation.y += deltaMove.x * 0.01;
                }
                previousMousePosition.x = event.clientX;
            }

            function onMouseUp(event) {
                if (isDragging) {
                    const deltaX = Math.abs(event.clientX - startMousePosition.x);
                    const deltaY = Math.abs(event.clientY - startMousePosition.y);
                    if (deltaX < clickThreshold && deltaY < clickThreshold) {
                        container.dispatchEvent(new CustomEvent('navigateToProducts'));
                    }
                }
                isDragging = false;
            }

            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);
            renderer.domElement.addEventListener('mouseleave', () => isDragging = false);
            
            function onTouchStart(event) { onMouseDown(event.touches[0]); }
            function onTouchMove(event) { onMouseMove(event.touches[0]); }
            function onTouchEnd(event) { onMouseUp(event.changedTouches[0]); }

            renderer.domElement.addEventListener('touchstart', onTouchStart, false);
            renderer.domElement.addEventListener('touchmove', onTouchMove, false);
            renderer.domElement.addEventListener('touchend', onTouchEnd, false);


            function animate() {
                requestAnimationFrame(animate);

                if (!isDragging) {
                    pivot.rotation.y += 0.005;
                }

                if (models.length === modelUrls.length) { // Assicurati che tutti i modelli siano caricati
                    const twoPi = Math.PI * 2;
                    const transitionDuration = Math.PI / 1.5; 
                    const startTransitionAngle = twoPi - transitionDuration;
                    
                    const normalizedAngle = (pivot.rotation.y % twoPi + twoPi) % twoPi;

                    if (lastAngle > startTransitionAngle && normalizedAngle < transitionDuration) {
                        activeModelIndex = (activeModelIndex + 1) % models.length;
                    }
                    lastAngle = normalizedAngle;
                    
                    const nextModelIndex = (activeModelIndex + 1) % models.length;
                    let progress = 0;

                    if (normalizedAngle > startTransitionAngle) {
                        progress = (normalizedAngle - startTransitionAngle) / transitionDuration;
                    }
                    
                    models.forEach((model, index) => {
                        if(index === activeModelIndex) {
                            setOpacity(model, 1 - progress);
                        } else if (index === nextModelIndex) {
                            setOpacity(model, progress);
                        } else {
                            setOpacity(model, 0);
                        }
                    });
                }

                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                if(container.clientWidth > 0 && container.clientHeight > 0){
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                }
            });
        }
    </script>
    <script src="https://player.vimeo.com/api/player.js"></script>
</body>
</html>
